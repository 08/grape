<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
<title>
  File: README
  
    &mdash; Documentation by YARD 0.8.3
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><div id='filecontents'><p><img src="https://github.com/intridea/grape/wiki/grape_logo.png" alt="grape logo"></p>

<h2>What is Grape?</h2>

<p>Grape is a REST-like API micro-framework for Ruby. It&#39;s designed to run on Rack
or complement existing web application frameworks such as Rails and Sinatra by
providing a simple DSL to easily develop RESTful APIs. It has built-in support
for common conventions, including multiple formats, subdomain/prefix restriction,
content negotiation, versioning and much more.</p>

<p><a href="http://travis-ci.org/intridea/grape"><img src="https://travis-ci.org/intridea/grape.png?branch=master" alt="Build Status"></a> <a href="https://codeclimate.com/github/intridea/grape"><img src="https://codeclimate.com/github/intridea/grape.png" alt="Code Climate"></a></p>

<h2>Stable Release</h2>

<p>You&#39;re reading the documentation for the stable 0.4.1 release of Grape.</p>

<h2>Project Tracking</h2>

<ul>
<li><a href="http://groups.google.com/group/ruby-grape">Grape Google Group</a></li>
<li><a href="https://github.com/intridea/grape/wiki">Grape Wiki</a></li>
</ul>

<h2>Installation</h2>

<p>Grape is available as a gem, to install it just install the gem:</p>

<pre class="code ruby"><code><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_install'>install</span> <span class='id identifier rubyid_grape'>grape</span>
</code></pre>

<p>If you&#39;re using Bundler, add the gem to Gemfile.</p>

<pre class="code ruby"><code><span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>grape</span><span class='tstring_end'>'</span></span>
</code></pre>

<p>Run <code>bundle install</code>.</p>

<h2>Basic Usage</h2>

<p>Grape APIs are Rack applications that are created by subclassing <code>Grape::API</code>.
Below is a simple example showing some of the more common features of Grape in
the context of recreating parts of the Twitter API.</p>

<pre class="code ruby"><code><span class='kw'>module</span> <span class='const'>Twitter</span>
  <span class='kw'>class</span> <span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>

    <span class='id identifier rubyid_version'>version</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>v1</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:using</span> <span class='op'>=&gt;</span> <span class='symbol'>:header</span><span class='comma'>,</span> <span class='symbol'>:vendor</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>twitter</span><span class='tstring_end'>'</span></span>
    <span class='id identifier rubyid_format'>format</span> <span class='symbol'>:json</span>

    <span class='id identifier rubyid_helpers'>helpers</span> <span class='kw'>do</span>
      <span class='kw'>def</span> <span class='id identifier rubyid_current_user'>current_user</span>
        <span class='ivar'>@current_user</span> <span class='op'>||=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_authorize!'>authorize!</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='kw'>def</span> <span class='id identifier rubyid_authenticate!'>authenticate!</span>
        <span class='id identifier rubyid_error!'>error!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>401 Unauthorized</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='int'>401</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_current_user'>current_user</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_resource'>resource</span> <span class='symbol'>:statuses</span> <span class='kw'>do</span>

      <span class='id identifier rubyid_desc'>desc</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Return a public timeline.</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_get'>get</span> <span class='symbol'>:public_timeline</span> <span class='kw'>do</span>
        <span class='const'>Status</span><span class='period'>.</span><span class='id identifier rubyid_limit'>limit</span><span class='lparen'>(</span><span class='int'>20</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_desc'>desc</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Return a personal timeline.</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_get'>get</span> <span class='symbol'>:home_timeline</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_authenticate!'>authenticate!</span>
        <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_statuses'>statuses</span><span class='period'>.</span><span class='id identifier rubyid_limit'>limit</span><span class='lparen'>(</span><span class='int'>20</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_desc'>desc</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Return a status.</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_params'>params</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_requires'>requires</span> <span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:type</span> <span class='op'>=&gt;</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:desc</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Status id.</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>:id</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
        <span class='const'>Status</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_desc'>desc</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Create a status.</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_params'>params</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_requires'>requires</span> <span class='symbol'>:status</span><span class='comma'>,</span> <span class='symbol'>:type</span> <span class='op'>=&gt;</span> <span class='const'>String</span><span class='comma'>,</span> <span class='symbol'>:desc</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Your status.</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_post'>post</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_authenticate!'>authenticate!</span>
        <span class='const'>Status</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span><span class='lparen'>(</span><span class='lbrace'>{</span>
          <span class='symbol'>:user</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='comma'>,</span>
          <span class='symbol'>:text</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span>
        <span class='rbrace'>}</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_desc'>desc</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Update a status.</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_params'>params</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_requires'>requires</span> <span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:type</span> <span class='op'>=&gt;</span> <span class='const'>String</span><span class='comma'>,</span> <span class='symbol'>:desc</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Status ID.</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_requires'>requires</span> <span class='symbol'>:status</span><span class='comma'>,</span> <span class='symbol'>:type</span> <span class='op'>=&gt;</span> <span class='const'>String</span><span class='comma'>,</span> <span class='symbol'>:desc</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Your status.</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_put'>put</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>:id</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
        <span class='id identifier rubyid_authenticate!'>authenticate!</span>
        <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_statuses'>statuses</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='lbrace'>{</span>
          <span class='symbol'>:user</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='comma'>,</span>
          <span class='symbol'>:text</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span>
        <span class='rbrace'>}</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_desc'>desc</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Delete a status.</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_params'>params</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_requires'>requires</span> <span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:type</span> <span class='op'>=&gt;</span> <span class='const'>String</span><span class='comma'>,</span> <span class='symbol'>:desc</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Status ID.</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_delete'>delete</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>:id</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
        <span class='id identifier rubyid_authenticate!'>authenticate!</span>
        <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_statuses'>statuses</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<h2>Mounting</h2>

<h3>Rack</h3>

<p>The above sample creates a Rack application that can be run from a rackup <code>config.ru</code> file
with <code>rackup</code>:</p>

<pre class="code ruby"><code><span class='id identifier rubyid_run'>run</span> <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>API</span>
</code></pre>

<p>And would respond to the following routes:</p>

<pre class="code ruby"><code>GET /statuses/public_timeline(.json)
GET /statuses/home_timeline(.json)
GET /statuses/:id(.json)
POST /statuses(.json)
PUT /statuses/:id(.json)
DELETE /statuses/:id(.json)
</code></pre>

<p>Grape will also automatically respond to HEAD and OPTIONS for all GET, and just OPTIONS for all other routes.</p>

<h3>Rails</h3>

<p>Place API files into <code>app/api</code> and modify <code>application.rb</code>.</p>

<pre class="code ruby"><code><span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_paths'>paths</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>app/api</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:glob</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>**/*.rb</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_autoload_paths'>autoload_paths</span> <span class='op'>+=</span> <span class='const'>Dir</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_root'>root</span><span class='rbrace'>}</span><span class='tstring_content'>/app/api/*</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
</code></pre>

<p>Modify <code>config/routes</code>:</p>

<pre class="code ruby"><code><span class='id identifier rubyid_mount'>mount</span> <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>API</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span>
</code></pre>

<p>See below for additional code that enables reloading of API changes in development.</p>

<h3>Modules</h3>

<p>You can mount multiple API implementations inside another one. These don&#39;t have to be
different versions, but may be components of the same API.</p>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>
  <span class='id identifier rubyid_mount'>mount</span> <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>APIv1</span>
  <span class='id identifier rubyid_mount'>mount</span> <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>APIv2</span>
<span class='kw'>end</span>
</code></pre>

<p>You can also mount on a path, which is similar to using <code>prefix</code> inside the mounted API itself.</p>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>
  <span class='id identifier rubyid_mount'>mount</span> <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>APIv1</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/v1</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span>
</code></pre>

<h2>Versioning</h2>

<p>There are three strategies in which clients can reach your API&#39;s endpoints: <code>:path</code>,
<code>:header</code> and <code>:param</code>. The default strategy is <code>:path</code>.</p>

<h3>Path</h3>

<pre class="code ruby"><code><span class='id identifier rubyid_version'>version</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>v1</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:using</span> <span class='op'>=&gt;</span> <span class='symbol'>:path</span>
</code></pre>

<p>Using this versioning strategy, clients should pass the desired version in the URL.</p>

<pre class="code ruby"><code>curl -H http://localhost:9292/v1/statuses/public_timeline
</code></pre>

<h3>Header</h3>

<pre class="code ruby"><code><span class='id identifier rubyid_version'>version</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>v1</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:using</span> <span class='op'>=&gt;</span> <span class='symbol'>:header</span><span class='comma'>,</span> <span class='symbol'>:vendor</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>twitter</span><span class='tstring_end'>'</span></span>
</code></pre>

<p>Using this versioning strategy, clients should pass the desired version in the HTTP <code>Accept</code> head.</p>

<pre class="code ruby"><code>curl -H Accept=application/vnd.twitter-v1+json http://localhost:9292/statuses/public_timeline
</code></pre>

<p>By default, the first matching version is used when no <code>Accept</code> header is
supplied. This behavior is similar to routing in Rails. To circumvent this default behavior,
one could use the <code>:strict</code> option. When this option is set to <code>true</code>, a <code>406 Not Acceptable</code> error
is returned when no correct <code>Accept</code> header is supplied.</p>

<h3>Param</h3>

<pre class="code ruby"><code><span class='id identifier rubyid_version'>version</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>v1</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:using</span> <span class='op'>=&gt;</span> <span class='symbol'>:param</span>
</code></pre>

<p>Using this versioning strategy, clients should pass the desired version as a request parameter,
either in the URL query string or in the request body.</p>

<pre class="code ruby"><code>curl -H http://localhost:9292/statuses/public_timeline?apiver=v1
</code></pre>

<p>The default name for the query parameter is &#39;apiver&#39; but can be specified using the <code>:parameter</code> option.</p>

<pre class="code ruby"><code><span class='id identifier rubyid_version'>version</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>v1</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:using</span> <span class='op'>=&gt;</span> <span class='symbol'>:param</span><span class='comma'>,</span> <span class='symbol'>:parameter</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>v</span><span class='tstring_end'>&quot;</span></span>
</code></pre>

<pre class="code ruby"><code>curl -H http://localhost:9292/statuses/public_timeline?v=v1
</code></pre>

<h2>Describing Methods</h2>

<p>You can add a description to API methods and namespaces.</p>

<pre class="code ruby"><code><span class='id identifier rubyid_desc'>desc</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Returns your public timeline.</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_get'>get</span> <span class='symbol'>:public_timeline</span> <span class='kw'>do</span>
  <span class='const'>Status</span><span class='period'>.</span><span class='id identifier rubyid_limit'>limit</span><span class='lparen'>(</span><span class='int'>20</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</code></pre>

<h2>Parameters</h2>

<p>Request parameters are available through the <code>params</code> hash object. This includes <code>GET</code>, <code>POST</code>
and <code>PUT</code> parameters, along with any named parameters you specify in your route strings.</p>

<pre class="code ruby"><code><span class='id identifier rubyid_get'>get</span> <span class='symbol'>:public_timeline</span> <span class='kw'>do</span>
  <span class='const'>Status</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:sort_by</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</code></pre>

<p>Parameters are automatically populated from the request body on POST and PUT for form input, JSON and
XML content-types.</p>

<p>The request:</p>

<pre class="code ruby"><code>curl -d '{&quot;text&quot;: &quot;140 characters&quot;}' 'http://localhost:9292/statuses' -H Content-Type:application/json -v
</code></pre>

<p>The Grape endpoint:</p>

<pre class="code ruby"><code><span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/statuses</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='const'>Status</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='symbol'>:text</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:text</span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</code></pre>

<p>Multipart POSTs and PUTs are supported as well.</p>

<p>The request:</p>

<pre class="code ruby"><code>curl --form image_file=image.jpg http://localhost:9292/upload
</code></pre>

<p>The Grape endpoint:</p>

<pre class="code ruby"><code><span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>upload</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='comment'># file in params[:image_file]
</span><span class='kw'>end</span>
</code></pre>

<h2>Parameter Validation and Coercion</h2>

<p>You can define validations and coercion options for your parameters using a <code>params</code> block.</p>

<pre class="code ruby"><code><span class='id identifier rubyid_params'>params</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_requires'>requires</span> <span class='symbol'>:id</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Integer</span>
  <span class='id identifier rubyid_optional'>optional</span> <span class='symbol'>:text</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>String</span><span class='comma'>,</span> <span class='label'>regexp:</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^[a-z]+$</span><span class='regexp_end'>/</span></span>
  <span class='id identifier rubyid_group'>group</span> <span class='symbol'>:media</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_requires'>requires</span> <span class='symbol'>:url</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_put'>put</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>:id</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='comment'># params[:id] is an Integer
</span><span class='kw'>end</span>
</code></pre>

<p>When a type is specified an implicit validation is done after the coercion to ensure
the output type is the one declared.</p>

<p>Parameters can be nested using <code>group</code>. In the above example, this means
<code>params[:media][:url]</code> is required along with <code>params[:id]</code>.</p>

<h3>Namespace Validation and Coercion</h3>

<p>Namespaces allow parameter definitions and apply to every method within the namespace.</p>

<pre class="code ruby"><code><span class='id identifier rubyid_namespace'>namespace</span> <span class='symbol'>:statuses</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_params'>params</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_requires'>requires</span> <span class='symbol'>:user_id</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='label'>desc:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>A user ID.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_namespace'>namespace</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:user_id</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_desc'>desc</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Retrieve a user's status.</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_params'>params</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_requires'>requires</span> <span class='symbol'>:status_id</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='label'>desc:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>A status ID.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:status_id</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:user_id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_statuses'>statuses</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:status_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>The <code>namespace</code> method has a number of aliases, including: <code>group</code>, <code>resource</code>,
<code>resources</code>, and <code>segment</code>. Use whichever reads the best for your API.</p>

<h3>Custom Validators</h3>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>AlphaNumeric</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>Validations</span><span class='op'>::</span><span class='const'>Validator</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_validate_param!'>validate_param!</span><span class='lparen'>(</span><span class='id identifier rubyid_attr_name'>attr_name</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='rparen'>)</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='id identifier rubyid_attr_name'>attr_name</span><span class='rbracket'>]</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^[[:alnum:]]+$</span><span class='regexp_end'>/</span></span>
      <span class='id identifier rubyid_throw'>throw</span> <span class='symbol'>:error</span><span class='comma'>,</span> <span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='int'>400</span><span class='comma'>,</span> <span class='symbol'>:message</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_attr_name'>attr_name</span><span class='rbrace'>}</span><span class='tstring_content'>: must consist of alpha-numeric characters</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<pre class="code ruby"><code><span class='id identifier rubyid_params'>params</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_requires'>requires</span> <span class='symbol'>:text</span><span class='comma'>,</span> <span class='symbol'>:alpha_numeric</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>
<span class='kw'>end</span>
</code></pre>

<p>You can also create custom classes that take parameters.</p>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>Length</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>Validations</span><span class='op'>::</span><span class='const'>SingleOptionValidator</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_validate_param!'>validate_param!</span><span class='lparen'>(</span><span class='id identifier rubyid_attr_name'>attr_name</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='rparen'>)</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='id identifier rubyid_attr_name'>attr_name</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&lt;=</span> <span class='ivar'>@option</span>
      <span class='id identifier rubyid_throw'>throw</span> <span class='symbol'>:error</span><span class='comma'>,</span> <span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='int'>400</span><span class='comma'>,</span> <span class='symbol'>:message</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_attr_name'>attr_name</span><span class='rbrace'>}</span><span class='tstring_content'>: must be at the most </span><span class='embexpr_beg'>#{</span><span class='ivar'>@option</span><span class='rbrace'>}</span><span class='tstring_content'> characters long</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<pre class="code ruby"><code><span class='id identifier rubyid_params'>params</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_requires'>requires</span> <span class='symbol'>:text</span><span class='comma'>,</span> <span class='symbol'>:length</span> <span class='op'>=&gt;</span> <span class='int'>140</span>
<span class='kw'>end</span>
</code></pre>

<h3>Validation Errors</h3>

<p>When validation and coercion errors occur an exception of type <code>Grape::Exceptions::Validation</code> is raised.
If the exception goes uncaught it will respond with a status of 400 and an error message.
You can rescue a <code>Grape::Exceptions::Validation</code> and respond with a custom response.</p>

<pre class="code ruby"><code><span class='id identifier rubyid_rescue_from'>rescue_from</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>Exceptions</span><span class='op'>::</span><span class='const'>Validation</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
    <span class='const'>Rack</span><span class='op'>::</span><span class='const'>Response</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='lbrace'>{</span>
        <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>status</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='comma'>,</span>
        <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>message</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='comma'>,</span>
        <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>param</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_param'>param</span>
    <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</code></pre>

<h2>Headers</h2>

<p>Request headers are available through the <code>headers</code> helper or from <code>env</code> in their original form.</p>

<pre class="code ruby"><code><span class='id identifier rubyid_get'>get</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_error!'>error!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Unauthorized</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='int'>401</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Secret-Password</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>swordfish</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span>
</code></pre>

<pre class="code ruby"><code><span class='id identifier rubyid_get'>get</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_error!'>error!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Unauthorized</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='int'>401</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>HTTP_SECRET_PASSWORD</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>swordfish</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span>
</code></pre>

<p>You can set a response header with <code>header</code> inside an API.</p>

<pre class="code ruby"><code><span class='id identifier rubyid_header'>header</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>X-Robots-Tag</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>noindex</span><span class='tstring_end'>&quot;</span></span>
</code></pre>

<h2>Routes</h2>

<p>Optionally, you can define requirements for your named route parameters using regular
expressions on namespace or endpoint. The route will match only if all requirements are met.</p>

<pre class="code ruby"><code><span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>:id</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:requirements</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:id</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[0-9]*</span><span class='regexp_end'>/</span></span> <span class='rbrace'>}</span> <span class='kw'>do</span>
  <span class='const'>Status</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_namespace'>namespace</span> <span class='symbol'>:outer</span><span class='comma'>,</span> <span class='symbol'>:requirements</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:id</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[0-9]*</span><span class='regexp_end'>/</span></span> <span class='rbrace'>}</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_get'>get</span> <span class='symbol'>:id</span> <span class='kw'>do</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:id/edit</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<h2>Helpers</h2>

<p>You can define helper methods that your endpoints can use with the <code>helpers</code>
macro by either giving a block or a module.</p>

<pre class="code ruby"><code><span class='kw'>module</span> <span class='const'>StatusHelpers</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_user_info'>user_info</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='rparen'>)</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user'>user</span><span class='rbrace'>}</span><span class='tstring_content'> has statused </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_statuses'>statuses</span><span class='rbrace'>}</span><span class='tstring_content'> status(s)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>
  <span class='comment'># define helpers with a block
</span>  <span class='id identifier rubyid_helpers'>helpers</span> <span class='kw'>do</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_current_user'>current_user</span>
      <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:user_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># or mix in a module
</span>  <span class='id identifier rubyid_helpers'>helpers</span> <span class='const'>StatusHelpers</span>

  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>info</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
    <span class='comment'># helpers available in your endpoint and filters
</span>    <span class='id identifier rubyid_user_info'>user_info</span><span class='lparen'>(</span><span class='id identifier rubyid_current_user'>current_user</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<h2>Cookies</h2>

<p>You can set, get and delete your cookies very simply using <code>cookies</code> method.</p>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>

  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>status_count</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_cookies'>cookies</span><span class='lbracket'>[</span><span class='symbol'>:status_count</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_cookies'>cookies</span><span class='lbracket'>[</span><span class='symbol'>:status_count</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='lbrace'>{</span> <span class='symbol'>:status_count</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_cookies'>cookies</span><span class='lbracket'>[</span><span class='symbol'>:status_count</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_delete'>delete</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>status_count</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
    <span class='lbrace'>{</span> <span class='symbol'>:status_count</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_cookies'>cookies</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:status_count</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

<span class='kw'>end</span>
</code></pre>

<p>Use a hash-based syntax to set more than one value.</p>

<pre class="code ruby"><code><span class='id identifier rubyid_cookies'>cookies</span><span class='lbracket'>[</span><span class='symbol'>:status_count</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='symbol'>:value</span> <span class='op'>=&gt;</span> <span class='int'>0</span><span class='comma'>,</span>
    <span class='symbol'>:expires</span> <span class='op'>=&gt;</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_tomorrow'>tomorrow</span><span class='comma'>,</span>
    <span class='symbol'>:domain</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>.twitter.com</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
    <span class='symbol'>:path</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span>
<span class='rbrace'>}</span>

<span class='id identifier rubyid_cookies'>cookies</span><span class='lbracket'>[</span><span class='symbol'>:status_count</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:value</span><span class='rbracket'>]</span> <span class='op'>+=</span><span class='int'>1</span>
</code></pre>

<p>Delete a cookie with <code>delete</code>.</p>

<pre class="code ruby"><code><span class='id identifier rubyid_cookies'>cookies</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='symbol'>:status_count</span>
</code></pre>

<p>Specify an optional path.</p>

<pre class="code ruby"><code><span class='id identifier rubyid_cookies'>cookies</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='symbol'>:status_count</span><span class='comma'>,</span> <span class='symbol'>:path</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span>
</code></pre>

<h2>Redirecting</h2>

<p>You can redirect to a new url temporarily (302) or permanently (301).</p>

<pre class="code ruby"><code><span class='id identifier rubyid_redirect'>redirect</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/statuses</span><span class='tstring_end'>&quot;</span></span>
</code></pre>

<pre class="code ruby"><code><span class='id identifier rubyid_redirect'>redirect</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/statuses</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:permanent</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>
</code></pre>

<h2>Allowed Methods</h2>

<p>When you add a <code>GET</code> route for a resource, a route for the <code>HEAD</code>
method will also be added automatically. You can disable this
behavior with <code>do_not_route_head!</code>.</p>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>

  <span class='id identifier rubyid_do_not_route_head!'>do_not_route_head!</span>

  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/example</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
    <span class='comment'># only responds to GET
</span>  <span class='kw'>end</span>

<span class='kw'>end</span>
</code></pre>

<p>When you add a route for a resource, a route for the <code>OPTIONS</code>
method will also be added. The response to an OPTIONS request will
include an &quot;Allow&quot; header listing the supported methods.</p>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>

  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/rt_count</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
    <span class='lbrace'>{</span> <span class='symbol'>:rt_count</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_rt_count'>rt_count</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_params'>params</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_requires'>requires</span> <span class='symbol'>:value</span><span class='comma'>,</span> <span class='symbol'>:type</span> <span class='op'>=&gt;</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:desc</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Value to add to the rt count.</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_put'>put</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/rt_count</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_rt_count'>rt_count</span> <span class='op'>+=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:value</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
    <span class='lbrace'>{</span> <span class='symbol'>:rt_count</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_rt_count'>rt_count</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

<span class='kw'>end</span>
</code></pre>

<pre class="code shell"><code>curl -v -X OPTIONS http://localhost:3000/rt_count

&gt; OPTIONS /rt_count HTTP/1.1
&gt;
&lt; HTTP/1.1 204 No Content
&lt; Allow: OPTIONS, GET, PUT
</code></pre>

<p>You can disable this behavior with <code>do_not_route_options!</code>.</p>

<p>If a request for a resource is made with an unsupported HTTP method, an
HTTP 405 (Method Not Allowed) response will be returned.</p>

<pre class="code shell"><code>curl -X DELETE -v http://localhost:3000/rt_count/

&gt; DELETE /rt_count/ HTTP/1.1
&gt; Host: localhost:3000
&gt;
&lt; HTTP/1.1 405 Method Not Allowed
&lt; Allow: OPTIONS, GET, PUT
</code></pre>

<h2>Raising Exceptions</h2>

<p>You can abort the execution of an API method by raising errors with <code>error!</code>.</p>

<pre class="code ruby"><code><span class='id identifier rubyid_error!'>error!</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Access Denied</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>401</span>
</code></pre>

<p>You can also return JSON formatted objects by raising error! and passing a hash
instead of a message.</p>

<pre class="code ruby"><code>error! { &quot;error&quot; =&gt; &quot;unexpected error&quot;, &quot;detail&quot; =&gt; &quot;missing widget&quot; }, 500
</code></pre>

<h2>Exception Handling</h2>

<p>Grape can be told to rescue all exceptions and return them in the API format.</p>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>
  <span class='id identifier rubyid_rescue_from'>rescue_from</span> <span class='symbol'>:all</span>
<span class='kw'>end</span>
</code></pre>

<p>You can also rescue specific exceptions.</p>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>
  <span class='id identifier rubyid_rescue_from'>rescue_from</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='const'>NotImplementedError</span>
<span class='kw'>end</span>
</code></pre>

<p>The error format will match the request format. See &quot;Content-Types&quot; below.</p>

<p>Custom error formatters for existing and additional types can be defined with a proc.</p>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>
  <span class='id identifier rubyid_error_formatter'>error_formatter</span> <span class='symbol'>:txt</span><span class='comma'>,</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='id identifier rubyid_backtrace'>backtrace</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span><span class='op'>|</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_message'>message</span><span class='rbrace'>}</span><span class='tstring_content'> from </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</code></pre>

<p>You can also use a module or class.</p>

<pre class="code ruby"><code><span class='kw'>module</span> <span class='const'>CustomFormatter</span>
  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='id identifier rubyid_backtrace'>backtrace</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span><span class='rparen'>)</span>
    <span class='lbrace'>{</span> <span class='label'>message:</span> <span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='label'>backtrace:</span> <span class='id identifier rubyid_backtrace'>backtrace</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>
  <span class='id identifier rubyid_error_formatter'>error_formatter</span> <span class='symbol'>:custom</span><span class='comma'>,</span> <span class='const'>CustomFormatter</span>
<span class='kw'>end</span>
</code></pre>

<p>You can rescue all exceptions with a code block. The <code>rack_response</code> wrapper
automatically sets the default error code and content-type.</p>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>
  <span class='id identifier rubyid_rescue_from'>rescue_from</span> <span class='symbol'>:all</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
    <span class='id identifier rubyid_rack_response'>rack_response</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='symbol'>:message</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rescued from </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>You can also rescue specific exceptions with a code block and handle the Rack
response at the lowest level.</p>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>
  <span class='id identifier rubyid_rescue_from'>rescue_from</span> <span class='symbol'>:all</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
    <span class='const'>Rack</span><span class='op'>::</span><span class='const'>Response</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='lbracket'>[</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='int'>500</span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Content-type</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>text/error</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_finish'>finish</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>Or rescue specific exceptions.</p>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>
  <span class='id identifier rubyid_rescue_from'>rescue_from</span> <span class='const'>ArgumentError</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
    <span class='const'>Rack</span><span class='op'>::</span><span class='const'>Response</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='lbracket'>[</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ArgumentError: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='int'>500</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_rescue_from'>rescue_from</span> <span class='const'>NotImplementedError</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
    <span class='const'>Rack</span><span class='op'>::</span><span class='const'>Response</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='lbracket'>[</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NotImplementedError: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='int'>500</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<h4>Rails 3.x</h4>

<p>When mounted inside Rails 3.x, errors like &quot;404 Not Found&quot; or &quot;406 Not Acceptable&quot; will likely be
handled and rendered by Rails handlers. For instance, accessing a nonexistent route &quot;/api/foo&quot;
raises a 404, which inside rails will ultimately be translated to an <code>ActionController::RoutingError</code>,
which most likely will get rendered to a HTML error page.</p>

<p>Most APIs will enjoy avoiding Rails exceptions and have their own exceptions reaching the client.
In that case, the <code>:cascade</code> option can be set to <code>false</code> on the versioning definition.</p>

<pre class="code ruby"><code><span class='id identifier rubyid_version'>version</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>v1</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:using</span> <span class='op'>=&gt;</span> <span class='symbol'>:header</span><span class='comma'>,</span> <span class='symbol'>:vendor</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>twitter</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:cascade</span> <span class='op'>=&gt;</span> <span class='kw'>false</span>
</code></pre>

<p>The <code>:cascade</code> option can also be used with the other versioning strategies (<code>:param</code> and <code>:path</code>).</p>

<h2>Logging</h2>

<p><code>Grape::API</code> provides a <code>logger</code> method which by default will return an instance of the <code>Logger</code>
class from Ruby&#39;s standard library.</p>

<p>To log messages from within an endpoint, you need to define a helper to make the logger
available in the endpoint context.</p>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>
  <span class='id identifier rubyid_helpers'>helpers</span> <span class='kw'>do</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_logger'>logger</span>
      <span class='const'>API</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/statuses</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
    <span class='comment'># ...
</span>    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_current_user'>current_user</span><span class='rbrace'>}</span><span class='tstring_content'> has statused</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>You can also set your own logger.</p>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>MyLogger</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_warning'>warning</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>this is a warning: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_message'>message</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>
  <span class='id identifier rubyid_logger'>logger</span> <span class='const'>MyLogger</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_helpers'>helpers</span> <span class='kw'>do</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_logger'>logger</span>
      <span class='const'>API</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/statuses</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warning'>warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_current_user'>current_user</span><span class='rbrace'>}</span><span class='tstring_content'> has statused</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<h2>API Formats</h2>

<p>By default, Grape supports <em>XML</em>, <em>JSON</em>, and <em>TXT</em> content-types. The default format is <code>:txt</code>.</p>

<p>Serialization takes place automatically. For example, you do not have to call <code>to_json</code> in each JSON API implementation.</p>

<p>Your API can declare which types to support by using <code>content_type</code>. Response format is determined by the
request&#39;s extension, an explicit <code>format</code> parameter in the query string, or <code>Accept</code> header.</p>

<p>The following API will only respond to the JSON content-type and will not parse any other input than <code>application/json</code>,
<code>application/x-www-form-urlencoded</code>, <code>multipart/form-data</code>, <code>multipart/related</code> and <code>multipart/mixed</code>. All other requests
will fail with an HTTP 406 error code.</p>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>
  <span class='id identifier rubyid_format'>format</span> <span class='symbol'>:json</span>
<span class='kw'>end</span>
</code></pre>

<p>If you combine <code>format</code> with <code>rescue_from :all</code>, errors will be rendered using the same format.
If you do not want this behavior, set the default error formatter with <code>default_error_formatter</code>.</p>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>
  <span class='id identifier rubyid_format'>format</span> <span class='symbol'>:json</span>
  <span class='id identifier rubyid_content_type'>content_type</span> <span class='symbol'>:txt</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>text/plain</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_default_error_formatter'>default_error_formatter</span> <span class='symbol'>:txt</span>
<span class='kw'>end</span>
</code></pre>

<p>Custom formatters for existing and additional types can be defined with a proc.</p>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>
  <span class='id identifier rubyid_content_type'>content_type</span> <span class='symbol'>:xls</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>application/vnd.ms-excel</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_formatter'>formatter</span> <span class='symbol'>:xls</span><span class='comma'>,</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span><span class='op'>|</span> <span class='id identifier rubyid_object'>object</span><span class='period'>.</span><span class='id identifier rubyid_to_xls'>to_xls</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
</code></pre>

<p>You can also use a module or class.</p>

<pre class="code ruby"><code><span class='kw'>module</span> <span class='const'>XlsFormatter</span>
  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_object'>object</span><span class='period'>.</span><span class='id identifier rubyid_to_xls'>to_xls</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>
  <span class='id identifier rubyid_content_type'>content_type</span> <span class='symbol'>:xls</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>application/vnd.ms-excel</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_formatter'>formatter</span> <span class='symbol'>:xls</span><span class='comma'>,</span> <span class='const'>XlsFormatter</span>
<span class='kw'>end</span>
</code></pre>

<p>Built-in formats are the following.</p>

<ul>
<li><code>:json</code>: use object&#39;s <code>to_json</code> when available, otherwise call <code>MultiJson.dump</code></li>
<li><code>:xml</code>: use object&#39;s <code>to_xml</code> when available, usually via <code>MultiXml</code>, otherwise call <code>to_s</code></li>
<li><code>:txt</code>: use object&#39;s <code>to_txt</code> when available, otherwise <code>to_s</code></li>
<li><code>:serializable_hash</code>: use object&#39;s <code>serializable_hash</code> when available, otherwise fallback to <code>:json</code></li>
</ul>

<p>Use <code>default_format</code> to set the fallback format when the format could not be determined from the <code>Accept</code> header.
See below for the order for choosing the API format.</p>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>
  <span class='id identifier rubyid_default_format'>default_format</span> <span class='symbol'>:json</span>
<span class='kw'>end</span>
</code></pre>

<p>The order for choosing the format is the following.</p>

<ul>
<li>Use the file extension, if specified. If the file is .json, choose the JSON format.</li>
<li>Use the value of the <code>format</code> parameter in the query string, if specified.</li>
<li>Use the format set by the <code>format</code> option, if specified.</li>
<li>Attempt to find an acceptable format from the <code>Accept</code> header.</li>
<li>Use the default format, if specified by the <code>default_format</code> option.</li>
<li>Default to <code>:txt</code>.</li>
</ul>

<h3>JSONP</h3>

<p>Grape suports JSONP via <a href="https://github.com/rack/rack-contrib">Rack::JSONP</a>, part of the
<a href="https://github.com/rack/rack-contrib">rack-contrib</a> gem. Add <code>rack-contrib</code> to your <code>Gemfile</code>.</p>

<pre class="code ruby"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>rack/contrib</span><span class='tstring_end'>'</span></span>

<span class='kw'>class</span> <span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>
  <span class='id identifier rubyid_use'>use</span> <span class='const'>Rack</span><span class='op'>::</span><span class='const'>JSONP</span>
  <span class='id identifier rubyid_format'>format</span> <span class='symbol'>:json</span>
  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
    <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Hello World</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<h3>CORS</h3>

<p>Grape supports CORS via <a href="https://github.com/cyu/rack-cors">Rack::CORS</a>, part of the
<a href="https://github.com/cyu/rack-cors">rack-cors</a> gem. Add <code>rack-cors</code> to your <code>Gemfile</code>.</p>

<pre class="code ruby"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>rack/cors</span><span class='tstring_end'>'</span></span>

<span class='kw'>class</span> <span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>
  <span class='id identifier rubyid_use'>use</span> <span class='const'>Rack</span><span class='op'>::</span><span class='const'>Cors</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_allow'>allow</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_origins'>origins</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>*</span><span class='tstring_end'>'</span></span>
      <span class='id identifier rubyid_resource'>resource</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>*</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:headers</span> <span class='op'>=&gt;</span> <span class='symbol'>:any</span><span class='comma'>,</span> <span class='symbol'>:methods</span> <span class='op'>=&gt;</span> <span class='symbol'>:get</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_format'>format</span> <span class='symbol'>:json</span>
  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
    <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Hello World</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<h2>Content-type</h2>

<p>Content-type is set by the formatter. You can override the content-type of the response at runtime
by setting the <code>Content-Type</code> header.</p>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>API</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>
  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/home_timeline_js</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_content_type'>content_type</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>application/javascript</span><span class='tstring_end'>&quot;</span></span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>var statuses = ...;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<h2>API Data Formats</h2>

<p>Grape accepts and parses input data sent with the POST and PUT methods as described in the Parameters
section above. It also supports custom data formats. You must declare additional content-types via
<code>content_type</code> and optionally supply a parser via <code>parser</code> unless a parser is already available within
Grape to enable a custom format. Such a parser can be a function or a class.</p>

<p>With a parser, parsed data is available &quot;as-is&quot; in <code>env[&#39;api.request.body&#39;]</code>.
Without a parser, data is available &quot;as-is&quot; and in <code>env[&#39;api.request.input&#39;]</code>.</p>

<p>The following example is a trivial parser that will assign any input with the &quot;text/custom&quot; content-type
to <code>:value</code>. The parameter will be available via <code>params[:value]</code> inside the API call.</p>

<pre class="code ruby"><code><span class='kw'>module</span> <span class='const'>CustomParser</span>
  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span><span class='rparen'>)</span>
    <span class='lbrace'>{</span> <span class='symbol'>:value</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_object'>object</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<pre class="code ruby"><code><span class='id identifier rubyid_content_type'>content_type</span> <span class='symbol'>:txt</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>text/plain</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_content_type'>content_type</span> <span class='symbol'>:custom</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>text/custom</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_parser'>parser</span> <span class='symbol'>:custom</span><span class='comma'>,</span> <span class='const'>CustomParser</span>

<span class='id identifier rubyid_put'>put</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>value</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:value</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</code></pre>

<p>You can invoke the above API as follows.</p>

<pre class="code ruby"><code>curl -X PUT -d 'data' 'http://localhost:9292/value' -H Content-Type:text/custom -v
</code></pre>

<h2>RESTful Model Representations</h2>

<p>Grape supports a range of ways to present your data with some help from a generic <code>present</code> method,
which accepts two arguments: the object to be presented and the options associated with it. The options
hash may include <code>:with</code>, which defines the entity to expose.</p>

<h3>Grape Entities</h3>

<p>Add the <a href="https://github.com/agileanimal/grape-entity">grape-entity</a> gem to your Gemfile.
Please refer to the <a href="https://github.com/agileanimal/grape-entity/blob/master/README.markdown">grape-entity documentation</a>
for more details.</p>

<p>The following example exposes statuses.</p>

<pre class="code ruby"><code>module API

  module Entities
    class Status &lt; Grape::Entity
      expose :user_name
      expose :text, :documentation =&gt; { :type =&gt; &quot;string&quot;, :desc =&gt; &quot;Status update text.&quot; }
      expose :ip, :if =&gt; { :type =&gt; :full }
      expose :user_type, user_id, :if =&gt; lambda{ |status, options| status.user.public? }
      expose :digest { |status, options| Digest::MD5.hexdigest(status.txt) }
      expose :replies, :using =&gt; API::Status, :as =&gt; :replies
    end
  end

  class Statuses &lt; Grape::API
    version 'v1'

    desc 'Statuses index', {
      :object_fields =&gt; API::Entities::Status.documentation
    }
    get '/statuses' do
      statuses = Status.all
      type = current_user.admin? ? :full : :default
      present statuses, with: API::Entities::Status, :type =&gt; type
    end
  end
end
</code></pre>

<p>In addition to separately organizing entities, it may be useful to put them as namespaced
classes underneath the model they represent.</p>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>Status</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_entity'>entity</span>
    <span class='const'>Status</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>class</span> <span class='const'>Entity</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>Entity</span>
    <span class='id identifier rubyid_expose'>expose</span> <span class='symbol'>:text</span><span class='comma'>,</span> <span class='symbol'>:user_id</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>If you organize your entities this way, Grape will automatically detect the <code>Entity</code> class and
use it to present your models. In this example, if you added <code>present Status.new</code> to your endpoint,
Grape will automatically detect that there is a <code>Status::Entity</code> class and use that as the
representative entity. This can still be overridden by using the <code>:with</code> option or an explicit
<code>represents</code> call.</p>

<h3>Hypermedia</h3>

<p>You can use any Hypermedia representer, including <a href="https://github.com/apotonick/roar">Roar</a>.
Roar renders JSON and works with the built-in Grape JSON formatter. Add <code>Roar::Representer::JSON</code>
into your models or call <code>to_json</code> explicitly in your API implementation.</p>

<h3>Rabl</h3>

<p>You can use <a href="https://github.com/nesquena/rabl">Rabl</a> templates with the help of the
<a href="https://github.com/LTe/grape-rabl">grape-rabl</a> gem, which defines a custom Grape Rabl
formatter.</p>

<h2>Authentication</h2>

<h3>Basic and Digest Auth</h3>

<p>Grape has built-in Basic and Digest authentication.</p>

<pre class="code ruby"><code><span class='id identifier rubyid_http_basic'>http_basic</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='op'>|</span>
  <span class='comment'># verify user's password here
</span>  <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>test</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>password1</span><span class='tstring_end'>'</span></span> <span class='rbrace'>}</span><span class='lbracket'>[</span><span class='id identifier rubyid_username'>username</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='id identifier rubyid_password'>password</span>
<span class='kw'>end</span>
</code></pre>

<pre class="code ruby"><code><span class='id identifier rubyid_http_digest'>http_digest</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='symbol'>:realm</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Test Api</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:opaque</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>app secret</span><span class='tstring_end'>'</span></span> <span class='rbrace'>}</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_username'>username</span><span class='op'>|</span>
  <span class='comment'># lookup the user's password here
</span>  <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>user1</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>password1</span><span class='tstring_end'>'</span></span> <span class='rbrace'>}</span><span class='lbracket'>[</span><span class='id identifier rubyid_username'>username</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</code></pre>

<p>Use <a href="https://github.com/opperator/warden-oauth2">warden-oauth2</a> or <a href="https://github.com/nov/rack-oauth2">rack-oauth2</a> for OAuth2 support.</p>

<h2>Describing and Inspecting an API</h2>

<p>Grape routes can be reflected at runtime. This can notably be useful for generating
documentation.</p>

<p>Grape exposes arrays of API versions and compiled routes. Each route
contains a <code>route_prefix</code>, <code>route_version</code>, <code>route_namespace</code>, <code>route_method</code>,
<code>route_path</code> and <code>route_params</code>. The description and the optional hash that
follows the API path may contain any number of keys and its values are also
accessible via dynamically-generated <code>route_[name]</code> functions.</p>

<pre class="code ruby"><code><span class='const'>TwitterAPI</span><span class='op'>::</span><span class='id identifier rubyid_versions'>versions</span> <span class='comment'># yields [ 'v1', 'v2' ]
</span><span class='const'>TwitterAPI</span><span class='op'>::</span><span class='id identifier rubyid_routes'>routes</span> <span class='comment'># yields an array of Grape::Route objects
</span><span class='const'>TwitterAPI</span><span class='op'>::</span><span class='id identifier rubyid_routes'>routes</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_route_version'>route_version</span> <span class='comment'># yields 'v1'
</span><span class='const'>TwitterAPI</span><span class='op'>::</span><span class='id identifier rubyid_routes'>routes</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_route_description'>route_description</span> <span class='comment'># etc.
</span></code></pre>

<h2>Current Route and Endpoint</h2>

<p>It&#39;s possible to retrieve the information about the current route from within an API
call with <code>route</code>.</p>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>MyAPI</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>
  <span class='id identifier rubyid_desc'>desc</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Returns a description of a parameter.</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_params'>params</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_requires'>requires</span> <span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:type</span> <span class='op'>=&gt;</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:desc</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Identity.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>params/:id</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_route'>route</span><span class='period'>.</span><span class='id identifier rubyid_route_params'>route_params</span><span class='lbracket'>[</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='comment'># yields the parameter description
</span>  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>The current endpoint responding to the request is <code>self</code> within the API block
or <code>env[&#39;api.endpoint&#39;]</code> elsewhere. The endpoint has some interesting properties,
such as <code>source</code> which gives you access to the original code block of the API
implementation. This can be particularly useful for building a logger middleware.</p>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>ApiLogger</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>Middleware</span><span class='op'>::</span><span class='const'>Base</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_before'>before</span>
    <span class='id identifier rubyid_file'>file</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>api.endpoint</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_source_location'>source_location</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>api.endpoint</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_source_location'>source_location</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[api] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_file'>file</span><span class='rbrace'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_line'>line</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<h2>Before and After</h2>

<p>Execute a block before or after every API call with <code>before</code> and <code>after</code>.</p>

<pre class="code ruby"><code><span class='id identifier rubyid_before'>before</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_header'>header</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>X-Robots-Tag</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>noindex</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</code></pre>

<h2>Anchoring</h2>

<p>Grape by default anchors all request paths, which means that the request URL
should match from start to end to match, otherwise a <code>404 Not Found</code> is
returned. However, this is sometimes not what you want, because it is not always
known upfront what can be expected from the call. This is because Rack-mount by
default anchors requests to match from the start to the end, or not at all.
Rails solves this problem by using a <code>:anchor =&gt; false</code> option in your routes.
In Grape this option can be used as well when a method is defined.</p>

<p>For instance when you&#39;re API needs to get part of an URL, for instance:</p>

<pre class="code ruby"><code><span class='kw'>class</span> <span class='const'>TwitterAPI</span> <span class='op'>&lt;</span> <span class='const'>Grape</span><span class='op'>::</span><span class='const'>API</span>
  <span class='id identifier rubyid_namespace'>namespace</span> <span class='symbol'>:statuses</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/(*:status)</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:anchor</span> <span class='op'>=&gt;</span> <span class='kw'>false</span> <span class='kw'>do</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>This will match all paths starting with &#39;/statuses/&#39;. There is one caveat though:
the <code>params[:status]</code> parameter only holds the first part of the request url.
Luckily this can be circumvented by using the described above syntax for path
specification and using the <code>PATH_INFO</code> Rack environment variable, using
<code>env[&quot;PATH_INFO&quot;]</code>. This will hold everything that comes after the &#39;/statuses/&#39;
part.</p>

<h2>Writing Tests</h2>

<p>You can test a Grape API with RSpec by making HTTP requests and examining the response.</p>

<h3>Writing Tests with Rack</h3>

<p>Use <code>rack-test</code> and define your API as <code>app</code>.</p>

<pre class="code ruby"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>spec_helper</span><span class='tstring_end'>'</span></span>

<span class='id identifier rubyid_describe'>describe</span> <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>API</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Rack</span><span class='op'>::</span><span class='const'>Test</span><span class='op'>::</span><span class='const'>Methods</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_app'>app</span>
    <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>API</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_describe'>describe</span> <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>API</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_describe'>describe</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GET /api/v1/statuses</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>returns an empty array of statuses</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
        <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/api/v1/statuses</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_last_response'>last_response</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span> <span class='op'>==</span> <span class='int'>200</span>
        <span class='const'>JSON</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_last_response'>last_response</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span> <span class='op'>==</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_describe'>describe</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GET /api/v1/statuses/:id</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>returns a status by id</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
        <span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='const'>Status</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span>
        <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/api/v1/statuses/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_last_response'>last_response</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span> <span class='op'>==</span> <span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<h3>Writing Tests with Rails</h3>

<pre class="code ruby"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>spec_helper</span><span class='tstring_end'>'</span></span>

<span class='id identifier rubyid_describe'>describe</span> <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>API</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_describe'>describe</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GET /api/v1/statuses</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>returns an empty array of statuses</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/api/v1/statuses</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span> <span class='op'>==</span> <span class='int'>200</span>
      <span class='const'>JSON</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span> <span class='op'>==</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_describe'>describe</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GET /api/v1/statuses/:id</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>returns a status by id</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='const'>Status</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span>
      <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/api/v1/statuses/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span> <span class='op'>==</span> <span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>In Rails, HTTP request tests would go into the <code>spec/requests</code> group. You may want your API code to go into
<code>app/api</code> - you can match that layout under <code>spec</code> by adding the following in <code>spec/spec_helper.rb</code>.</p>

<pre class="code ruby"><code><span class='const'>RSpec</span><span class='period'>.</span><span class='id identifier rubyid_configure'>configure</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_config'>config</span><span class='op'>|</span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_include'>include</span> <span class='const'>RSpec</span><span class='op'>::</span><span class='const'>Rails</span><span class='op'>::</span><span class='const'>RequestExampleGroup</span><span class='comma'>,</span> <span class='symbol'>:type</span> <span class='op'>=&gt;</span> <span class='symbol'>:request</span><span class='comma'>,</span> <span class='symbol'>:example_group</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
    <span class='symbol'>:file_path</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>spec\/api</span><span class='regexp_end'>/</span></span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</code></pre>

<h2>Reloading API Changes in Development</h2>

<h3>Rails 3.x</h3>

<p>Add API paths to <code>config/application.rb</code>.</p>

<pre class="code ruby"><code><span class='comment'># Auto-load API and its subdirectories
</span><span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_paths'>paths</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>app/api</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:glob</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>**/*.rb</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_autoload_paths'>autoload_paths</span> <span class='op'>+=</span> <span class='const'>Dir</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_root'>root</span><span class='rbrace'>}</span><span class='tstring_content'>/app/api/*</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
</code></pre>

<p>Create <code>config/initializers/reload_api.rb</code>.</p>

<pre class="code ruby"><code><span class='kw'>if</span> <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_env'>env</span><span class='period'>.</span><span class='id identifier rubyid_development?'>development?</span>
  <span class='id identifier rubyid_api_files'>api_files</span> <span class='op'>=</span> <span class='const'>Dir</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_root'>root</span><span class='rbrace'>}</span><span class='tstring_content'>/app/api/**/*.rb</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_api_reloader'>api_reloader</span> <span class='op'>=</span> <span class='const'>ActiveSupport</span><span class='op'>::</span><span class='const'>FileUpdateChecker</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_api_files'>api_files</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_reload_routes!'>reload_routes!</span>
  <span class='kw'>end</span>
  <span class='const'>ActionDispatch</span><span class='op'>::</span><span class='const'>Callbacks</span><span class='period'>.</span><span class='id identifier rubyid_to_prepare'>to_prepare</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_api_reloader'>api_reloader</span><span class='period'>.</span><span class='id identifier rubyid_execute_if_updated'>execute_if_updated</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>See <a href="http://stackoverflow.com/questions/3282655/ruby-on-rails-3-reload-lib-directory-for-each-request/4368838#4368838">StackOverflow #3282655</a> for more information.</p>

<h2>Performance Monitoring</h2>

<p>Grape integrates with NewRelic via the <a href="https://github.com/flyerhzm/newrelic-grape">newrelic-grape</a> gem.</p>

<h2>Contributing to Grape</h2>

<p>Grape is work of dozens of contributors. You&#39;re encouraged to submit pull requests, propose
features and discuss issues.</p>

<ul>
<li>Fork the project</li>
<li>Write tests for your new feature or a test that reproduces a bug</li>
<li>Implement your feature or make a bug fix</li>
<li>Add a line to <code>CHANGELOG.md</code> describing your change</li>
<li>Commit, push and make a pull request. Bonus points for topic branches.</li>
</ul>

<h2>License</h2>

<p>MIT License. See LICENSE for details.</p>

<h2>Copyright</h2>

<p>Copyright (c) 2010-2013 Michael Bleigh, and Intridea, Inc.</p>
</div></div>

    <div id="footer">
  Generated on Sun Apr 14 15:48:04 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.3 (ruby-1.9.3).
</div>

  </body>
</html>